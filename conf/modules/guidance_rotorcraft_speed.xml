<!DOCTYPE module SYSTEM "module.dtd">

<module name="guidance_rotorcraft_speed" dir="guidance">
  <doc>
    <description>
      Guidance code for rotorcraft with speed output Only
      It provides:
      - horizontal guidance with reference
      - vertical guidance with reference
      Can be used with drones like Tello
    </description>
    <section name="GUIDANCE_SPEED" prefix="GUIDANCE_SPEED_">
      <define name="H_PGAIN" value="79" description="feedback horizontal control P gain"/>
      <define name="H_DGAIN" value="100" description="feedback horizontal control D gain"/>
      <define name="H_IGAIN" value="30" description="feedback horizontal control I gain"/>
      <define name="V_PGAIN" value="283" description="feedback vertical control P gain"/>
      <define name="V_DGAIN" value="82" description="feedback vertical control D gain"/>
      <define name="V_IGAIN" value="13" description="feedback vertical control I gain"/>
    </section>
  </doc>
  <settings target="ap|nps">
    <dl_settings>
      <dl_settings NAME="Vert Loop">
        <dl_setting var="guidance_speed.max_v_speed" min="0.1" step="0.1" max="15.0" shortname="max_speed" param="GUIDANCE_SPEED_MAX_V_SPEED" type="float" persistent="true" module="guidance/guidance_speed"/>
        <dl_setting var="guidance_speed.v_gains.p" min="0." step="0.001" max="10." shortname="kp" handler="set_v_pgain" param="GUIDANCE_SPEED_H_PGAIN" persistent="true" module="guidance/guidance_speed"/>
        <dl_setting var="guidance_speed.v_gains.d" min="0." step="0.001" max="10." shortname="kd" handler="set_v_dgain" param="GUIDANCE_SPEED_H_DGAIN" persistent="true" module="guidance/guidance_speed"/>
        <dl_setting var="guidance_speed.v_gains.i" min="0." step="0.001" max="10." shortname="ki" handler="set_v_igain" param="GUIDANCE_SPEED_H_IGAIN" persistent="true" module="guidance/guidance_speed"/>
        <dl_setting var="guidance_speed.sp.pos.z" min="-10." step="0.5" max="3." shortname="sp" unit="m"/>
      </dl_settings>
      <dl_settings NAME="Horiz Loop">
        <dl_setting var="guidance_speed.max_h_speed" min="0.1" step="0.1" max="15.0" shortname="max_speed" param="GUIDANCE_SPEED_MAX_H_SPEED" type="float" persistent="true" module="guidance/guidance_speed"/>
        <dl_setting var="guidance_speed.h_gains.p" min="0." step="0.001" max="10." shortname="kp" handler="set_h_pgain" param="GUIDANCE_SPEED_PGAIN" persistent="true" module="guidance/guidance_speed"/>
        <dl_setting var="guidance_speed.h_gains.d" min="0." step="0.001" max="10." shortname="kd" handler="set_h_dgain" param="GUIDANCE_SPEED_DGAIN" persistent="true" module="guidance/guidance_speed"/>
        <dl_setting var="guidance_speed.h_gains.i" min="0." step="0.001" max="10." shortname="ki" handler="set_h_igain" param="GUIDANCE_SPEED_IGAIN" persistent="true" module="guidance/guidance_speed"/>
        <dl_setting var="guidance_speed.sp.pos.x" MIN="-10" MAX="10" STEP="1" shortname="sp_x_ned" unit="m"/>
        <dl_setting var="guidance_speed.sp.pos.y" MIN="-10" MAX="10" STEP="1" shortname="sp_y_ned" unit="m"/>
      </dl_settings>
    </dl_settings>
  </settings>
  <header>
    <file name="guidance_speed.h"/>
  </header>
  <init fun="guidance_speed_init()"/>
  <makefile target="ap|nps|hitl" firmware="rotorcraft">
    <file name="guidance_speed.c" dir="$(SRC_FIRMWARE)/guidance"/>
  </makefile>
</module>
