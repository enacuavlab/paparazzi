<!DOCTYPE module SYSTEM "module.dtd">

<module name="gvf_advanced" dir="guidance/gvf_advanced">
  <doc>
    <description>Guidance algorithm for tracking 2D and 3D smooth trajectories. This algorithm can track self-intersected paths (such as 8-shape). "Advanced" does not mean better but it deals with more complicated trajectories, if you are interested in 2D trajectories that are parallel to the ground, please, use the gvf_module since it works fantastic for such a case. For more details we refer to https://wiki.paparazziuav.org/wiki/Module/guidance_vector_field . This algorithm needs of Eigen library, be sure you have it installed, e.g., git submodule update --init --recursive sw/ext/eigen .
    </description>
  </doc>

  <settings name="GVF_ADVANCED">
    <dl_settings>
      <dl_settings NAME="GVF_ADVANCED">
        <dl_settings NAME="Control">
          <dl_setting MAX="1" MIN="-1" STEP="2" VAR="gvf_advanced_control.s" shortname = "direction"/>
        </dl_settings>
        <dl_settings NAME="3D_ellipse">
          <dl_setting MAX="5" MIN="0.0" STEP="0.01" VAR="gvf_advanced_3d_ellipse_par.ktheta" shortname="3d_ell_ktheta" param="GVF_ADVANCED_3D_ELLIPSE_KTHETA"/>
          <dl_setting MAX="5" MIN="0.0" STEP="0.01" VAR="gvf_advanced_3d_ellipse_par.kx" shortname="3d_ell_kx" param="GVF_ADVANCED_3D_ELLIPSE_KX"/>
          <dl_setting MAX="5" MIN="0.0" STEP="0.01" VAR="gvf_advanced_3d_ellipse_par.ky" shortname="3d_ell_ky" param="GVF_ADVANCED_3D_ELLIPSE_KY"/>
          <dl_setting MAX="5" MIN="0.0" STEP="0.01" VAR="gvf_advanced_3d_ellipse_par.kz" shortname="3d_ell_kz" param="GVF_ADVANCED_3D_ELLIPSE_KZ"/>
          <dl_setting MAX="150" MIN="0.0" STEP="10" VAR="gvf_advanced_3d_ellipse_par.r" shortname="3d_ell_r" param="GVF_ADVANCED_3D_ELLIPSE_R"/>
          <dl_setting MAX="150" MIN="10" STEP="5" VAR="gvf_advanced_3d_ellipse_par.zl" shortname="3d_ell_zl" param="GVF_ADVANCED_3D_ELLIPSE_ZL"/>
          <dl_setting MAX="150" MIN="10" STEP="5" VAR="gvf_advanced_3d_ellipse_par.zh" shortname="3d_ell_zh" param="GVF_ADVANCED_3D_ELLIPSE_ZH"/>
          <dl_setting MAX="180" MIN="-180" STEP="1" VAR="gvf_advanced_3d_ellipse_par.alpha" shortname="3d_ell_alpha" param="GVF_ADVANCED_3D_ELLIPSE_ALPHA"/>
        </dl_settings>
      </dl_settings>
    </dl_settings>
  </settings>

  <header>
    <file name="gvf_advanced.h"/>
    <file name="trajectories/gvf_advanced_3d_ellipse.h"/>
  </header>

  <init fun = "gvf_advanced_init()"/>

  <makefile target="ap|nps" firmware="fixedwing">
    <configure name="CXXSTANDARD" value="-std=c++14"/>
    <flag name="CXXFLAGS" value="Wno-int-in-bool-context"/>
    <include name="$(PAPARAZZI_SRC)/sw/ext/eigen"/>
    <define name="EIGEN_NO_MALLOC"/>
    <define name="EIGEN_NO_AUTOMATIC_RESIZING"/>
    <file name="gvf_advanced.cpp"/>
    <file name="trajectories/gvf_advanced_3d_ellipse.c"/>
    <flag name="LDFLAGS" value="lstdc++" />
  </makefile>

  <makefile target="ap" firmware="fixedwing">
    <define name="EIGEN_NO_DEBUG"/>
  </makefile>
</module>
