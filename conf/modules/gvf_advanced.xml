<!DOCTYPE module SYSTEM "module.dtd">

<module name="gvf_advanced" dir="guidance/gvf_advanced">
  <doc>
    <description>Guidance algorithm for tracking 2D and 3D smooth trajectories. This algorithm can track self-intersected paths (such as 8-shape). "Advanced" does not mean better but it deals with more complicated trajectories, if you are interested in 2D trajectories that are parallel to the ground, please, use the gvf_module since it works fantastic for such a case. For more details we refer to https://wiki.paparazziuav.org/wiki/Module/guidance_vector_field . This algorithm needs of Eigen library, be sure you have it installed, e.g., git submodule update --init --recursive sw/ext/eigen .
    </description>
  </doc>

  <settings name="GVF_ADVANCED">
    <dl_settings>
      <dl_settings NAME="GVF_ADVANCED">
        <dl_settings NAME="Control">
          <dl_setting MAX="1" MIN="-1" STEP="2" VAR="gvf_advanced_control.s" shortname = "direction"/>
          <dl_setting MAX="1.25" MIN="0.75" STEP="0.05" VAR="gvf_advanced_control.k_roll" shortname="k_roll" param="GVF_ADVANCED_CONTROL_KROLL"/>
          <dl_setting MAX="1.25" MIN="0.75" STEP="0.05" VAR="gvf_advanced_control.k_climb" shortname="k_climb" param="GVF_ADVANCED_CONTROL_KCLIMB"/>
          <dl_setting MAX="10" MIN="0.01" STEP="0.05" VAR="gvf_advanced_control.L" shortname="L" param="GVF_ADVANCED_CONTROL_L"/>
          <dl_setting MAX="1" MIN="0.001" STEP="0.005" VAR="gvf_advanced_control.beta" shortname="beta" param="GVF_ADVANCED_CONTROL_BETA"/>
          <dl_setting MAX="1.5" MIN="0.5" STEP="0.01" VAR="gvf_advanced_control.k_psi" shortname="k_psi" param="GVF_ADVANCED_CONTROL_KPSI"/>
        </dl_settings>
        <dl_settings NAME="2D_trefoil">
          <dl_setting MAX="0.01" MIN="0.0" STEP="0.0005" VAR="gvf_advanced_2d_trefoil_par.kx" shortname="2d_tre_kx" param="GVF_ADVANCED_2D_TREFOIL_KX"/>
          <dl_setting MAX="0.01" MIN="0.0" STEP="0.0005" VAR="gvf_advanced_2d_trefoil_par.ky" shortname="2d_tre_ky" param="GVF_ADVANCED_2D_TREFOIL_KY"/>
          <dl_setting MAX="1" MIN="0.0" STEP="0.01" VAR="gvf_advanced_2d_trefoil_par.w1" shortname="2d_tre_w1" param="GVF_ADVANCED_2D_TREFOIL_W1"/>
          <dl_setting MAX="1" MIN="0.0" STEP="0.01" VAR="gvf_advanced_2d_trefoil_par.w2" shortname="2d_tre_w2" param="GVF_ADVANCED_2D_TREFOIL_W2"/>
          <dl_setting MAX="200" MIN="10" STEP="5" VAR="gvf_advanced_2d_trefoil_par.ratio" shortname="2d_tre_ratio" param="GVF_ADVANCED_2D_TREFOIL_RATIO"/>
          <dl_setting MAX="200" MIN="10" STEP="5" VAR="gvf_advanced_2d_trefoil_par.r" shortname="2d_tre_r" param="GVF_ADVANCED_2D_TREFOIL_R"/>
        </dl_settings>
        <dl_settings NAME="3D_ellipse">
          <dl_setting MAX="0.01" MIN="0.0" STEP="0.0005" VAR="gvf_advanced_3d_ellipse_par.kx" shortname="3d_ell_kx" param="GVF_ADVANCED_3D_ELLIPSE_KX"/>
          <dl_setting MAX="0.01" MIN="0.0" STEP="0.0005" VAR="gvf_advanced_3d_ellipse_par.ky" shortname="3d_ell_ky" param="GVF_ADVANCED_3D_ELLIPSE_KY"/>
          <dl_setting MAX="0.1" MIN="0.0" STEP="0.0005" VAR="gvf_advanced_3d_ellipse_par.kz" shortname="3d_ell_kz" param="GVF_ADVANCED_3D_ELLIPSE_KZ"/>
          <dl_setting MAX="150" MIN="0.0" STEP="5" VAR="gvf_advanced_3d_ellipse_par.r" shortname="3d_ell_r" param="GVF_ADVANCED_3D_ELLIPSE_R"/>
          <dl_setting MAX="150" MIN="10" STEP="5" VAR="gvf_advanced_3d_ellipse_par.zl" shortname="3d_ell_zl" param="GVF_ADVANCED_3D_ELLIPSE_ZL"/>
          <dl_setting MAX="150" MIN="10" STEP="5" VAR="gvf_advanced_3d_ellipse_par.zh" shortname="3d_ell_zh" param="GVF_ADVANCED_3D_ELLIPSE_ZH"/>
          <dl_setting MAX="180" MIN="-180" STEP="1" VAR="gvf_advanced_3d_ellipse_par.alpha" shortname="3d_ell_alpha" param="GVF_ADVANCED_3D_ELLIPSE_ALPHA"/>
        </dl_settings>
      </dl_settings>
    </dl_settings>
  </settings>

  <header>
    <file name="gvf_advanced.h"/>
    <file name="trajectories/gvf_advanced_3d_ellipse.h"/>
    <file name="trajectories/gvf_advanced_2d_trefoil.h"/>
  </header>

  <init fun = "gvf_advanced_init()"/>

  <makefile target="ap|nps" firmware="fixedwing">
    <configure name="CXXSTANDARD" value="-std=c++14"/>
    <flag name="CXXFLAGS" value="Wno-int-in-bool-context"/>
    <include name="$(PAPARAZZI_SRC)/sw/ext/eigen"/>
    <define name="EIGEN_NO_MALLOC"/>
    <define name="EIGEN_NO_AUTOMATIC_RESIZING"/>
    <file name="gvf_advanced.cpp"/>
    <file name="trajectories/gvf_advanced_3d_ellipse.c"/>
    <file name="trajectories/gvf_advanced_2d_trefoil.c"/>
    <flag name="LDFLAGS" value="lstdc++" />
  </makefile>

  <makefile target="ap" firmware="fixedwing">
    <define name="EIGEN_NO_DEBUG"/>
  </makefile>
</module>
